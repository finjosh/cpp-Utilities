# directory that the makefile was called from
MKFILE_PATH:=$(abspath $(lastword $(MAKEFILE_LIST)))
PROJECT_FOLDER_NAME:=$(strip $(notdir $(patsubst %/,%,$(dir $(MKFILE_PATH)))))
PROJECT_DIR:=$(patsubst %/makefile,%, $(MKFILE_PATH))
#! DONT EDIT ABOVE THIS

# exe name
PROJECT:=main
# the directory in which all .o and .d files will be made
OBJ_O_DIR:=bin
# the include flags for compilation
INCLUDES:=-I \VSCodeFolder\Libraries\raylib-master\src -I /VSCodeFolder/Libraries/TGUI-1.2.0/include
# the paths to libs for linking
LIBS=-L \VSCodeFolder\Libraries\raylib-master\src -L /VSCodeFolder/Libraries/TGUI-1.2.0/lib -L $(PROJECT_DIR)

SRC=src
MAIN=main

# the directory for lib files
LIB_DIR:=libs

#! DONT EDIT ANYTHING FROM HERE DOWN

ifeq ($(OS),Windows_NT)
	EXE := .exe
	FIXPATH = $(subst /,\,$1)
	SOURCEDIRS := $(shell dir $(SRC) /s /b /ad) $(call FIXPATH,$(PROJECT_DIR)/$(SRC))
	INCLUDEDIRS := $(INCLUDE)
	LIBDIRS	:= $(LIB)
	RM := del /q /f
	MD := mkdir
else
	EXE :=
	SOURCEDIRS := $(shell find "$$PWD" -type d -path "*$(PROJECT_DIR)/$(SRC)*")
	INCLUDEDIRS	:= $(INCLUDE)
	LIBDIRS	:= $(LIB)
	FIXPATH = $(subst \,/,$1)
	RM = rm -r --preserve-root
	MD := mkdir -p
endif

# all .cpp file paths
SRC:=$(foreach D,$(SOURCEDIRS) $(PROJECT_DIR),$(wildcard $(D)/*.cpp))
# Create an object file of every cpp file
OBJECTS=$(addprefix $(OBJ_O_DIR)/,$(patsubst %.cpp,%.o,$(SRC)))
# Creating dependency files
DEPFILES=$(patsubst %.o,%.d,$(OBJECTS))

OUTPATHS:=$(foreach d,$(filter-out ./,$(SOURCEDIRS)),$(OBJ_O_DIR)/$(d)/)

# so there is no file that gets mistaked with the tasks listed
.PHONY = all info clean

clean:
	$(call makeBinDir)
# $(shell ${RM} $(OBJ_O_DIR) $(PROJECT).exe)

# makes a dir for the given path
makeDir=$(shell ${MD} $(call FIXPATH,$1))
# make bin directories 
# TODO redo this as fixpath is not being used
makeBinDir=$(foreach d,$(filter-out ./,$(call FIXPATH,$(SOURCEDIRS))),$(call makeDir,$(patsubst $(call FIXPATH,$(OBJ_O_DIR)/%/),$(call FIXPATH,$(OBJ_O_DIR)/%),$(call FIXPATH,$(OBJ_O_DIR)/$(patsubst $(call FIXPATH,$(PROJECT_DIR)/%),%,$(d))))))

info:
	@echo Project Directory: $(PROJECT_DIR)
	@echo Project Folder Name: $(PROJECT_FOLDER_NAME)
	@echo Makefile Directory: $(MKFILE_PATH)
	@echo Source Directories: $(SOURCEDIRS) 
# @echo Source Files: $(SRC)
	@echo Debug: $(foreach d,$(filter-out ./,$(call FIXPATH,$(SOURCEDIRS))),$(patsubst $(call FIXPATH,$(OBJ_O_DIR)/%/),$(call FIXPATH,$(OBJ_O_DIR)/%),$(call FIXPATH,$(OBJ_O_DIR)/$(patsubst $(call FIXPATH,$(PROJECT_DIR)/%),%,$(d)))))
